{"version":3,"sources":["../../src/utils/exec.js"],"names":[],"mappings":";;;;;;kQAAA;;;kBAIwB,I;;AAHxB;;AACA;;;;;;AAEe,SAAS,IAAT,CAAc,OAAd,EAA+B,OAA/B,EAAgD,MAAhD,EAAqE;AAClF,SAAO,IAAI,OAAJ,CAAY,CAAC,OAAD,EAAU,MAAV,KAAqB;AACtC,UAAM,QAAQ,CACZ,SADY,EAEZ,OAAO,MAAP,GAAgB,MAAhB,GAAyB,SAFb,EAGZ,OAAO,MAAP,GAAgB,MAAhB,GAAyB,SAHb,CAAd;AAKA,UAAM,QAAQ,0BAAM,OAAN,eAAoB,OAApB,IAA6B,KAA7B,IAAd;AACA,QAAI,MAAJ;AACA,QAAI,OAAO,MAAX,EAAmB;AACjB,eAAS,OAAO,MAAP,EAAT;AACA,YAAM,MAAN,CAAa,IAAb,CAAkB,MAAlB,EAA0B,IAA1B,CAA+B,QAAQ,MAAvC;AACD;AACD,QAAI,MAAJ;AACA,QAAI,OAAO,MAAX,EAAmB;AACjB,eAAS,OAAO,MAAP,EAAT;AACA,YAAM,MAAN,CAAa,IAAb,CAAkB,MAAlB,EAA0B,IAA1B,CAA+B,QAAQ,MAAvC;AACD;AACD,UAAM,EAAN,CAAS,MAAT,EAAkB,IAAD,IAAU;AACzB,UAAI,SAAS,CAAb,EAAgB;AACd,gBAAQ,GAAR,CAAa;IAAA,CACjB,gBAAM,GAAN,CAAU,OAAV,CAAmB,OAAI,QAAQ,GAAI;KAAA,CAClC,OAAQ,yBAAsB,IAAK;CAFhC;AAID;AACD,UAAI,MAAJ,EAAY;AACV,eAAO,MAAP;AACD;AACD,UAAI,MAAJ,EAAY;AACV,eAAO,MAAP;AACD;AACD;AACD,KAdD;AAeA,UAAM,EAAN,CAAS,OAAT,EAAkB,MAAlB;AACD,GAjCM,CAAP;AAkCD","file":"exec.js","sourcesContent":["/* eslint-disable no-console */\nimport { spawn } from 'child_process';\nimport chalk from 'chalk';\n\nexport default function exec(command: string, options: Object, config: PhaseConfig) {\n  return new Promise((resolve, reject) => {\n    const stdio = [\n      'inherit',\n      config.stdout ? 'pipe' : 'inherit',\n      config.stderr ? 'pipe' : 'inherit',\n    ];\n    const child = spawn(command, { ...options, stdio });\n    let stdout;\n    if (config.stdout) {\n      stdout = config.stdout();\n      child.stdout.pipe(stdout).pipe(process.stdout);\n    }\n    let stderr;\n    if (config.stderr) {\n      stderr = config.stderr();\n      child.stderr.pipe(stderr).pipe(process.stderr);\n    }\n    child.on('exit', (code) => {\n      if (code !== 0) {\n        console.log(`\n> ${chalk.red('ERROR')} [${options.cwd}]\n> '${command}': exited with code ${code}\n`);\n      }\n      if (stdout) {\n        stdout.unpipe();\n      }\n      if (stderr) {\n        stderr.unpipe();\n      }\n      resolve();\n    });\n    child.on('error', reject);\n  });\n}\n"]}